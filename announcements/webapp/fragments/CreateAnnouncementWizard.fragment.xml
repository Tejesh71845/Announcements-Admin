<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:form="sap.ui.layout.form"
    xmlns:layout="sap.ui.layout"
    xmlns:table="sap.ui.table"
>
    <Dialog
        id="createWizardDialog"
        title="{= ${wizardModel>/isEditMode} ? ${i18n>wizardTitleEdit} : ${i18n>wizardTitle}}"
        contentWidth="100%"
        resizable="false"
        showHeader="true"
        draggable="false"
    >
        <customHeader>
            <Bar>
                <contentMiddle>
                    <Title
                        text="{= ${wizardModel>/isEditMode} ? ${i18n>wizardTitleEdit} : ${i18n>wizardTitle}}"
                    />
                </contentMiddle>
                <!-- <contentRight>
                    <Button
                        icon="sap-icon://decline"
                        press="onCancelPress"
                        tooltip="{i18n>closeTooltip}"
                        type="Transparent"
                    />
                </contentRight> -->
            </Bar>
        </customHeader>

        <content>
            <!-- ========================================
                 SINGLE ENTRY WIZARD
                 ======================================== -->
            <Wizard
                id="singleWizard"
                enableBranching="false"
                showNextButton="false"
                visible="{wizardModel>/showSingleWizard}"
                class="sapUiMediumMargin"
            >
                <!-- Step 1 -->
                <WizardStep
                    id="singleSelectionStep"
                    title="{i18n>selectOptionTitle}"
                    validated="false"
                    icon="sap-icon://home"
                    visible="{= ${wizardModel>/isEditMode} !== true}"
                >
                    <content>
                        <VBox
                            class="sapUiMediumMargin"
                            alignItems="Center"
                        >
                            <Title
                                text="{i18n>chooseOptionTitle}"
                                level="H3"
                                class="sapUiMediumMarginBottom"
                            />

                            <Text
                                text="{i18n>selectCreationModeText}"
                                class="sapUiMediumMarginBottom"
                                textAlign="Center"
                            />

                            <HBox
                                class="sapUiLargeMarginTop"
                                alignItems="Center"
                            >
                                <Button
                                    text="{i18n>singleEntryButton}"
                                    press="onSingleFlowSelected"
                                    type="Emphasized"
                                    icon="sap-icon://document"
                                    width="150px"
                                    class="sapUiMediumMarginEnd"
                                />
                                <!-- <Button
                                    text="{i18n>bulkUploadButton}"
                                    press="onSwitchToBulkWizard"
                                    type="Default"
                                    icon="sap-icon://upload"
                                    width="150px"
                                /> -->
                            </HBox>
                        </VBox>
                    </content>
                </WizardStep>

                <!-- Step 2 -->
                <WizardStep
                    id="singleCreateStep"
                    title="{= ${wizardModel>/isEditMode} ? ${i18n>wizardTitleEdit} : ${i18n>wizardTitle}}"
                    validated="{wizardModel>/singleCreateStepValidated}"
                    icon="{= ${wizardModel>/isEditMode} ? 'sap-icon://edit' : 'sap-icon://add'}"
                    activate="onSingleCreateStepActivate"
                >
                    <content>
                        <VBox class="sapUiMediumMargin">
                            <form:SimpleForm
                                layout="ResponsiveGridLayout"
                                editable="true"
                                class="sapUiResponsiveMargin"
                            >
                                <form:content>
                                    <Label
                                        text="{i18n>titleLabel}"
                                        required="{= !${wizardModel>/isDraftMode}}"
                                    />
                                    <Input
                                        id="singleTitleInput"
                                        value="{wizardModel>/title}"
                                        placeholder="{i18n>titlePlaceholder}"
                                        valueState="{wizardModel>/titleValueState}"
                                        valueStateText="{wizardModel>/titleValueStateText}"
                                        liveChange="onSingleInputChange"
                                        maxLength="100"
                                    />

                                    <Label
                                        text="{i18n>announcementTypeLabel}"
                                        required="{= !${wizardModel>/isDraftMode}}"
                                    />
                                    <MultiComboBox
                                        id="singleAnnouncementTypeMultiComboBox"
                                        selectedKeys="{wizardModel>/announcementType}"
                                        selectionChange="onSingleAnnouncementTypeSelectionChange"
                                        valueState="{wizardModel>/announcementTypeValueState}"
                                        valueStateText="{wizardModel>/announcementTypeValueStateText}"
                                        items="{announcementTypeModel>/types}"
                                        width="100%"
                                        placeholder="{i18n>announcementTypePlaceholder}"
                                    >
                                        <core:Item
                                            key="{announcementTypeModel>key}"
                                            text="{announcementTypeModel>text}"
                                        />
                                    </MultiComboBox>

                                    <Label
                                        text="{i18n>categoryLabel}"
                                        required="false"
                                    />
                                    <MultiComboBox
                                        id="singleCategoryMultiComboBox"
                                        selectedKeys="{wizardModel>/category}"
                                        selectionChange="onSingleCategorySelectionChange"
                                        valueState="{wizardModel>/categoryValueState}"
                                        valueStateText="{wizardModel>/categoryValueStateText}"
                                        items="{categoryModel>/category}"
                                        width="100%"
                                        placeholder="{i18n>categoryMultiPlaceholder}"
                                    >
                                        <core:Item
                                            key="{categoryModel>key}"
                                            text="{categoryModel>text}"
                                        />
                                    </MultiComboBox>

                                    <Label
                                        text="{i18n>descriptionLabel}"
                                        required="{= !${wizardModel>/isDraftMode}}"
                                    />
                                    <VBox
                                        id="richTextContainer"
                                        width="100%"
                                        class="sapUiNoMargin"
                                    />
                                </form:content>
                            </form:SimpleForm>

                            <!-- Publish Date Section -->
                            <VBox class="sapUiMediumMarginTop">
                                <Title
                                    text="{i18n>publishDateTitle}"
                                    level="H4"
                                    class="sapUiSmallMarginBottom"
                                />

                                <form:SimpleForm
                                    layout="ResponsiveGridLayout"
                                    editable="true"
                                >
                                    <form:content>
                                        <Label
                                            text="{i18n>publishTimingLabel}"
                                            required="{= !${wizardModel>/isDraftMode}}"
                                        />
                                        <HBox>
                                            <RadioButton
                                                id="publishPublishRadio"
                                                text="{i18n>publishNow}"
                                                groupName="publishOptionGroup"
                                                selected="{= ${wizardModel>/publishOption} === 'PUBLISH'}"
                                                select="onPublishOptionRadioSelect"
                                            />
                                            <RadioButton
                                                id="publishUnpublishRadio"
                                                text="{i18n>publishLater}"
                                                groupName="publishOptionGroup"
                                                selected="{= ${wizardModel>/publishOption} === 'UNPUBLISH'}"
                                                select="onPublishOptionRadioSelect"
                                                class="sapUiTinyMarginBegin"
                                            />
                                        </HBox>

                                        <Label
                                            text="{i18n>startDate}"
                                            visible="{= ${wizardModel>/showDatePickers}}"
                                            required="{= !${wizardModel>/isDraftMode}}"
                                        />
                                        <DatePicker
                                            id="publishStartDatePicker"
                                            value="{wizardModel>/publishStartDate}"
                                            valueState="{wizardModel>/publishStartDateValueState}"
                                            valueStateText="{wizardModel>/publishStartDateValueStateText}"
                                            change="onPublishStartDateChange"
                                            displayFormat="dd/MM/yyyy"
                                            valueFormat="yyyy-MM-dd"
                                            placeholder="{wizardModel>/startDatePlaceholder}"
                                            enabled="{wizardModel>/startDateEnabled}"
                                            visible="{= ${wizardModel>/showDatePickers}}"
                                            minDate="{wizardModel>/minPublishDate}"
                                            width="50%"
                                        />

                                        <Label
                                            text="{i18n>endDate}"
                                            visible="{wizardModel>/showDatePickers}"
                                            required="{= !${wizardModel>/isDraftMode}}"
                                        />
                                        <DatePicker
                                            id="publishEndDatePicker"
                                            value="{wizardModel>/publishEndDate}"
                                            valueState="{wizardModel>/publishEndDateValueState}"
                                            valueStateText="{wizardModel>/publishEndDateValueStateText}"
                                            change="onPublishEndDateChange"
                                            displayFormat="dd/MM/yyyy"
                                            valueFormat="yyyy-MM-dd"
                                            placeholder="{wizardModel>/endDatePlaceholder}"
                                            enabled="{wizardModel>/endDateEnabled}"
                                            visible="{wizardModel>/showDatePickers}"
                                            minDate="{wizardModel>/minEndDate}"
                                            width="50%"
                                        />
                                    </form:content>
                                </form:SimpleForm>
                            </VBox>

                            <!-- Draft Mode Message -->
                            <!-- <MessageStrip
                                text="{i18n>draftModePublishLaterMessage}"
                                type="Information"
                                visible="{= ${wizardModel>/publishOption} === 'UNPUBLISH'}"
                                class="sapUiMediumMarginTop"
                            /> -->
                        </VBox>
                    </content>
                </WizardStep>

                <!-- Step 3 -->
                <!-- <WizardStep
                    id="singleReviewStep"
                    title="{i18n>reviewStepTitle}"
                    validated="true"
                    icon="sap-icon://to-be-reviewed"
                >
                    <content>
                        <VBox class="sapUiMediumMargin">
                            

                            <form:SimpleForm
                                layout="ResponsiveGridLayout"
                                editable="false"
                                class="sapUiResponsiveMargin"
                            >
                                <form:content>
                                    <Label text="{i18n>titleLabel}" />
                                    <Text text="{wizardModel>/title}" />

                                    <Label
                                        text="{i18n>announcementTypeLabel}"
                                    />
                                    <Text
                                        text="{wizardModel>/announcementTypeDisplayName}"
                                    />

                                    <Label text="{i18n>categoryLabel}" />
                                    <Text
                                        text="{wizardModel>/categoryDisplayName}"
                                    />

                                    <Label text="{i18n>descriptionLabel}" />
                                    <VBox
                                        id="reviewRichTextContainer"
                                        width="100%"
                                    >
                                    </VBox>
                                </form:content>
                            </form:SimpleForm>

                            

                            <VBox class="sapUiMediumMarginTop">
                                <Title
                                    text="{i18n>publishDateTitle}"
                                    level="H4"
                                    class="sapUiSmallMarginBottom"
                                />

                                <form:SimpleForm
                                    layout="ResponsiveGridLayout"
                                    editable="true"
                                >
                                    <form:content>
                                        <Label
                                            text="{i18n>publishTimingLabel}"
                                        />

                                        <HBox>
                                            <RadioButton
                                                id="publishPublishRadio"
                                                text="{i18n>publishNow}"
                                                groupName="publishOptionGroup"
                                                selected="{= ${wizardModel>/publishOption} === 'PUBLISH'}"
                                                select="onPublishOptionRadioSelect"
                                            />
                                            <RadioButton
                                                id="publishUnpublishRadio"
                                                text="{i18n>publishLater}"
                                                groupName="publishOptionGroup"
                                                selected="{= ${wizardModel>/publishOption} === 'UNPUBLISH'}"
                                                select="onPublishOptionRadioSelect"
                                                class="sapUiTinyMarginBegin"
                                            />
                                        </HBox>

                                        <Label
                                            text="{i18n>startDate}"
                                            visible="{wizardModel>/showDatePickers}"
                                        />
                                        <DatePicker
                                            id="publishStartDatePicker"
                                            value="{wizardModel>/publishStartDate}"
                                            valueState="{wizardModel>/publishStartDateValueState}"
                                            valueStateText="{wizardModel>/publishStartDateValueStateText}"
                                            change="onPublishStartDateChange"
                                            displayFormat="dd/MM/yyyy"
                                            valueFormat="yyyy-MM-dd"
                                            placeholder="{wizardModel>/startDatePlaceholder}"
                                            enabled="{wizardModel>/startDateEnabled}"
                                            visible="{wizardModel>/showDatePickers}"
                                            minDate="{wizardModel>/minPublishDate}"
                                            width="50%"
                                        />

                                        <Label
                                            text="{i18n>endDate}"
                                            visible="{wizardModel>/showDatePickers}"
                                        />
                                        <DatePicker
                                            id="publishEndDatePicker"
                                            value="{wizardModel>/publishEndDate}"
                                            valueState="{wizardModel>/publishEndDateValueState}"
                                            valueStateText="{wizardModel>/publishEndDateValueStateText}"
                                            change="onPublishEndDateChange"
                                            displayFormat="dd/MM/yyyy"
                                            valueFormat="yyyy-MM-dd"
                                            placeholder="{wizardModel>/endDatePlaceholder}"
                                            enabled="{wizardModel>/endDateEnabled}"
                                            visible="{wizardModel>/showDatePickers}"
                                            minDate="{wizardModel>/minEndDate}"
                                            width="50%"
                                        />
                                    </form:content>
                                </form:SimpleForm>
                            </VBox>

                            <MessageStrip
                                text="{= ${wizardModel>/isEditMode} ? ${i18n>reviewEditInfoMessage} : ${i18n>reviewCreateInfoMessage}}"
                                type="Information"
                                class="sapUiMediumMarginTop"
                            />

                        </VBox>
                    </content>
                </WizardStep> -->
            </Wizard>

            <!-- ========================================
                 BULK UPLOAD WIZARD
                 ======================================== -->
            <Wizard
                id="bulkWizard"
                complete="onWizardComplete"
                enableBranching="false"
                showNextButton="false"
                visible="{wizardModel>/showBulkWizard}"
                class="sapUiMediumMargin"
            >
                <!-- Step 1: Selection Option (BULK flow) -->
                <WizardStep
                    id="bulkSelectionStep"
                    title="Select Option"
                    validated="false"
                    icon="sap-icon://home"
                >
                    <content>
                        <VBox
                            class="sapUiMediumMargin"
                            alignItems="Center"
                        >
                            <Title
                                text="Choose Your Option"
                                level="H3"
                                class="sapUiMediumMarginBottom"
                            />
                            <Text
                                text="Please select how you want to create announcements"
                                class="sapUiMediumMarginBottom"
                                textAlign="Center"
                            />

                            <HBox
                                class="sapUiLargeMarginTop"
                                alignItems="Center"
                            >
                                <Button
                                    text="Single Entry"
                                    press="onSwitchToSingleWizard"
                                    type="Default"
                                    icon="sap-icon://document"
                                    width="150px"
                                    class="sapUiMediumMarginEnd"
                                />
                                <Button
                                    text="Bulk Upload"
                                    press="onBulkFlowSelected"
                                    type="Emphasized"
                                    icon="sap-icon://upload"
                                    width="150px"
                                />
                            </HBox>
                        </VBox>
                    </content>
                </WizardStep>

                <!-- Step 2: Download Template (BULK flow) -->
                <WizardStep
                    id="bulkDownloadStep"
                    title="Download Template"
                    validated="{wizardModel>/bulkDownloadStepValidated}"
                    icon="sap-icon://download"
                    activate="onBulkDownloadStepActivate"
                >
                    <content>
                        <VBox
                            class="sapUiMediumMargin"
                            alignItems="Center"
                        >
                            <Title
                                text="Download Template File"
                                level="H3"
                                class="sapUiMediumMarginBottom"
                            />
                            <Text
                                text="Download the Excel template file to fill in your announcements data"
                                class="sapUiMediumMarginBottom"
                                textAlign="Center"
                            />

                            <VBox
                                alignItems="Center"
                                class="sapUiLargeMarginTop"
                            >
                                <Button
                                    text="Download Template"
                                    press="onDownloadTemplatePress"
                                    type="Emphasized"
                                    icon="sap-icon://download"
                                    width="200px"
                                    class="sapUiMediumMarginBottom"
                                />

                                <Text
                                    text="Template Status: {wizardModel>/downloadStatus}"
                                    class="sapUiSmallMarginTop"
                                />
                            </VBox>

                            <MessageStrip
                                text="{wizardModel>/downloadMessage}"
                                type="{wizardModel>/downloadMessageType}"
                                visible="{wizardModel>/showDownloadMessage}"
                                class="sapUiMediumMarginTop"
                            />
                        </VBox>
                    </content>
                </WizardStep>

                <!-- Step 3: Upload Template (BULK flow) -->
                <WizardStep
                    id="bulkUploadStep"
                    title="Upload Template"
                    validated="{wizardModel>/bulkUploadStepValidated}"
                    icon="sap-icon://upload"
                    activate="onBulkUploadStepActivate"
                >
                    <content>
                        <VBox
                            class="sapUiMediumMargin"
                            alignItems="Center"
                        >
                            <Title
                                text="Upload Filled Template"
                                level="H3"
                                class="sapUiMediumMarginBottom"
                            />
                            <Text
                                text="Upload your filled Excel template file"
                                class="sapUiMediumMarginBottom"
                                textAlign="Center"
                            />

                            <VBox
                                alignItems="Center"
                                class="sapUiLargeMarginTop"
                            >
                                <Button
                                    text="Upload Template"
                                    press="onUploadTemplatePress"
                                    type="Emphasized"
                                    icon="sap-icon://upload"
                                    width="200px"
                                    class="sapUiMediumMarginBottom"
                                />

                                <Text
                                    text="Upload Status: {wizardModel>/uploadStatus}"
                                    class="sapUiSmallMarginTop"
                                />
                            </VBox>

                            <MessageStrip
                                text="{wizardModel>/uploadMessage}"
                                type="{wizardModel>/uploadMessageType}"
                                visible="{wizardModel>/showUploadMessage}"
                                class="sapUiMediumMarginTop"
                            />
                        </VBox>
                    </content>
                </WizardStep>

                <!-- Step 4: Review (BULK flow) - UPDATED -->
                <WizardStep
                    id="bulkReviewStep"
                    title="Review"
                    validated="true"
                    icon="sap-icon://to-be-reviewed"
                    activate="onBulkReviewStepActivate"
                >
                    <content>
                        <VBox class="sapUiMediumMargin">
                            <Title
                                text="Review Bulk Upload"
                                level="H3"
                                class="sapUiMediumMarginBottom"
                            />
                            <Text
                                text="Review and edit your announcements before publishing. Click on any cell to edit."
                                class="sapUiMediumMarginBottom"
                                textAlign="Center"
                            />

                            <!-- Summary Information -->
                            <HBox
                                class="sapUiSmallMarginBottom"
                                justifyContent="SpaceBetween"
                            >
                                <Text
                                    text="Total Records: {= ${wizardModel>/bulkData}.length }"
                                />
                            </HBox>

                            <!-- Editable Review Table -->
                            <table:Table
                                id="bulkReviewTable"
                                rows="{wizardModel>/bulkData}"
                                selectionMode="None"
                                visibleRowCount="{= Math.min(${wizardModel>/bulkData}.length, 10) }"
                                width="100%"
                                alternateRowColors="true"
                                columnHeaderVisible="true"
                                class="sapUiSizeCompact"
                            >
                                <table:extension>
                                    <OverflowToolbar>
                                        <Title
                                            text="Announcements Preview (Editable)"
                                            level="H5"
                                        />
                                        <ToolbarSpacer />
                                        <Text
                                            text="{= ${wizardModel>/bulkData}.length } items"
                                        />
                                    </OverflowToolbar>
                                </table:extension>

                                <table:columns>
                                    <table:Column width="200px">
                                        <Label text="Title*" />
                                        <table:template>
                                            <Input
                                                value="{wizardModel>title}"
                                                change="onBulkTableInputChange"
                                                placeholder="Enter title"
                                            />
                                        </table:template>
                                    </table:Column>

                                    <table:Column width="150px">
                                        <Label text="Announcement Type*" />
                                        <table:template>
                                            <Input
                                                value="{wizardModel>announcementType}"
                                                change="onBulkTableInputChange"
                                                placeholder="e.g., Global, Emergency"
                                            />
                                        </table:template>
                                    </table:Column>

                                    <table:Column width="150px">
                                        <Label text="Category*" />
                                        <table:template>
                                            <Input
                                                value="{wizardModel>category}"
                                                change="onBulkTableInputChange"
                                                placeholder="Enter category"
                                            />
                                        </table:template>
                                    </table:Column>

                                    <table:Column width="200px">
                                        <Label text="Description*" />
                                        <table:template>
                                            <TextArea
                                                value="{wizardModel>description}"
                                                change="onBulkTableInputChange"
                                                rows="2"
                                                placeholder="Enter description"
                                            />
                                        </table:template>
                                    </table:Column>

                                    <table:Column width="120px">
                                        <Label text="Start Date*" />
                                        <table:template>
                                            <DatePicker
                                                value="{wizardModel>startDate}"
                                                change="onBulkTableInputChange"
                                                displayFormat="dd/MM/yyyy"
                                                valueFormat="yyyy-MM-dd"
                                                placeholder="dd/MM/yyyy"
                                            />
                                        </table:template>
                                    </table:Column>

                                    <table:Column width="120px">
                                        <Label text="End Date*" />
                                        <table:template>
                                            <DatePicker
                                                value="{wizardModel>endDate}"
                                                change="onBulkTableInputChange"
                                                displayFormat="dd/MM/yyyy"
                                                valueFormat="yyyy-MM-dd"
                                                placeholder="dd/MM/yyyy"
                                            />
                                        </table:template>
                                    </table:Column>
                                </table:columns>
                            </table:Table>

                            <MessageStrip
                                text="* All fields are required. Click Submit to save {= ${wizardModel>/bulkData}.length } record(s)."
                                type="Information"
                                class="sapUiMediumMarginTop"
                                showIcon="true"
                            />
                        </VBox>
                    </content>
                </WizardStep>
            </Wizard>
        </content>

        <!-- ========================================
             BUTTONS
             ======================================== -->

        <buttons>
            <Button
                id="cancelButtonReview"
                text="{i18n>cancelButton}"
                press="onCancelPress"
                type="Transparent"
                icon="sap-icon://decline"
                visible="{wizardModel>/showCancelButton}"
            />

            <Button
                id="resetButton"
                text="{i18n>resetButton}"
                press="onResetPress"
                type="Transparent"
                icon="sap-icon://reset"
                visible="{wizardModel>/showResetButton}"
            />

            <!-- <Button
                id="draftButton"
                text="{i18n>draftButton}"
                type="Transparent"
                press="onDraftPress"
                icon="sap-icon://save"
                visible="{= ${wizardModel>/showDraftButton} &amp;&amp; ${wizardModel>/currentFlow} !== 'BULK'}"
                enabled="{wizardModel>/draftEnabled}"
            /> -->

            <Button
                id="submitButton"
                text="{i18n>submitButton}"
                type="Emphasized"
                press="onSubmitPress"
                icon="sap-icon://message-success"
                visible="{wizardModel>/showSubmitButton}"
                enabled="{wizardModel>/submitEnabled}"
            />
        </buttons>
    </Dialog>
</core:FragmentDefinition>
