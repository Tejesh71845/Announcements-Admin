<mvc:View
    controllerName="com.incture.announcements.controller.Announcement"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
    xmlns:f="sap.f"
    displayBlock="true"
    height="100%"
>
    <!-- ShellBar at the top -->
    <core:Fragment
        fragmentName="com.incture.announcements.fragments.ShellBar"
        type="XML"
    />

    <!-- Main Content -->

    <smartTable:SmartTable
        id="idAnnouncementsSmartTbl"
        entitySet="Announcements"
        tableType="ResponsiveTable"
        enableAutoBinding="true"
        useVariantManagement="true"
        useTablePersonalisation="true"
        header="Announcements"
        showRowCount="true"
        enableCopy="false"
        enableExport="false"
        demandPopin="true"
        class="sapUiResponsiveMargin smartTableBorderCss"
        beforeRebindTable="onBeforeRebindTable"
        enableAutoColumnWidth="true"
        placeToolbarInTable="true"
        requestAtLeastFields="description,announcementStatus,announcementType"
    >
        <smartTable:customToolbar>
            <OverflowToolbar design="Transparent">
                <Button
                    id="idAllStatusFilterBtn"
                    text="{
                        parts: [
                            {path: 'i18n>filterBtnAll'},
                            {path: 'announcementCountModel>/allCount'}
                        ],
                        formatter: '.formatter.formatFilterBtnLabel'
                    }"
                    type="{
                        path: 'announcementCountModel>/activeFilter',
                        formatter: '.formatter.formatFilterBtnTypeAll'
                    }"
                    press="onStatusFilterPress"
                    class="statusFilterBtnCss"
                >
                    <customData>
                        <core:CustomData
                            key="filterKey"
                            value="all"
                        />
                    </customData>
                </Button>

                <Button
                    id="idPublishedStatusFilterBtn"
                    text="{
                        parts: [
                            {path: 'i18n>filterBtnPublished'},
                            {path: 'announcementCountModel>/publishedCount'}
                        ],
                        formatter: '.formatter.formatFilterBtnLabel'
                    }"
                    type="{
                        path: 'announcementCountModel>/activeFilter',
                        formatter: '.formatter.formatFilterBtnTypePublished'
                    }"
                    press="onStatusFilterPress"
                    class="statusFilterBtnCss"
                >
                    <customData>
                        <core:CustomData
                            key="filterKey"
                            value="published"
                        />
                    </customData>
                </Button>

                <Button
                    id="idScheduledStatusFilterBtn"
                    text="{
                        parts: [
                            {path: 'i18n>filterBtnScheduled'},
                            {path: 'announcementCountModel>/scheduledCount'}
                        ],
                        formatter: '.formatter.formatFilterBtnLabel'
                    }"
                    type="{
                        path: 'announcementCountModel>/activeFilter',
                        formatter: '.formatter.formatFilterBtnTypeScheduled'
                    }"
                    press="onStatusFilterPress"
                    class="statusFilterBtnCss"
                >
                    <customData>
                        <core:CustomData
                            key="filterKey"
                            value="scheduled"
                        />
                    </customData>
                </Button>

                <Button
                    id="idExpiredStatusFilterBtn"
                    text="{
                        parts: [
                            {path: 'i18n>filterBtnExpired'},
                            {path: 'announcementCountModel>/expiredCount'}
                        ],
                        formatter: '.formatter.formatFilterBtnLabel'
                    }"
                    type="{
                        path: 'announcementCountModel>/activeFilter',
                        formatter: '.formatter.formatFilterBtnTypeExpired'
                    }"
                    press="onStatusFilterPress"
                    class="statusFilterBtnCss"
                >
                    <customData>
                        <core:CustomData
                            key="filterKey"
                            value="expired"
                        />
                    </customData>
                </Button>

                <Button
                    id="idInvalidStatusFilterBtn"
                    text="{
                        parts: [
                            {path: 'i18n>filterBtnInvalid'},
                            {path: 'announcementCountModel>/invalidCount'}
                        ],
                        formatter: '.formatter.formatFilterBtnLabel'
                    }"
                    type="{
                        path: 'announcementCountModel>/activeFilter',
                        formatter: '.formatter.formatFilterBtnTypeInvalid'
                    }"
                    press="onStatusFilterPress"
                    class="statusFilterBtnCss"
                >
                    <customData>
                        <core:CustomData
                            key="filterKey"
                            value="invalid"
                        />
                    </customData>
                </Button>

                <ToolbarSpacer />
                <SearchField
                    id="idAnnouncementSearchFld"
                    width="20%"
                    class="sapUiSmallMargin"
                    search="onSearchAnnouncement"
                    liveChange="onSearchLiveChange"
                />
                <MenuButton
                    id="idCreateAnnouncementMenuBtn"
                    text="{i18n>createButton}"
                    type="Emphasized"
                    defaultAction="onCreateSidebarPress"
                >
                    <menu>
                        <Menu>
                            <MenuItem
                                text="{i18n>createSidebarMenuItem}"
                                press="onCreateSidebarPress"
                            />
                            <MenuItem
                                text="{i18n>createBannerMenuItem}"
                                press="onCreateBannerPress"
                            />
                        </Menu>
                    </menu>
                </MenuButton>
            </OverflowToolbar>
        </smartTable:customToolbar>
        <smartTable:layoutData>
            <FlexItemData
                growFactor="1"
                baseSize="0%"
            />
        </smartTable:layoutData>
        <Table
            id="idAnnouncementsTable"
            growing="true"
            growingThreshold="10"
        >
            <columns>
                <Column>
                    <Text text="{i18n>categoryColumn}" />
                    <customData>
                        <core:CustomData
                            key="p13nData"
                            value="{'columnKey': 'category', 'columnIndex': '2', 'leadingProperty': 'category'}"
                        />
                    </customData>
                </Column>
                <Column>
                    <Text text="{i18n>publishedOnColumn}" />
                    <customData>
                        <core:CustomData
                            key="p13nData"
                            value="{'columnKey': 'publishedAt', 'columnIndex': '3', 'leadingProperty': 'publishedAt'}"
                        />
                    </customData>
                </Column>

                <Column>
                    <Text text="{i18n>expiredOnColumn}" />
                    <customData>
                        <core:CustomData
                            key="p13nData"
                            value="{'columnKey': 'endAnnouncement', 'columnIndex': '4', 'leadingProperty': 'endAnnouncement'}"
                        />
                    </customData>
                </Column>

                <Column>
                    <Text text="{i18n>modifiedOnColumn}" />
                    <customData>
                        <core:CustomData
                            key="p13nData"
                            value="{'columnKey': 'modifiedAt', 'columnIndex': '5', 'leadingProperty': 'modifiedAt'}"
                        />
                    </customData>
                </Column>

                <Column>
                    <Text text="{i18n>statusColumn}" />
                    <customData>
                        <core:CustomData
                            key="p13nData"
                            value="{'columnKey': 'announcementStatus', 'columnIndex': '6', 'leadingProperty': 'announcementStatus'}"
                        />
                    </customData>
                </Column>
                <Column>
                    <Text text="{i18n>actionsColumn}" />
                    <customData>
                        <core:CustomData
                            key="p13nData"
                            value="{'columnKey': 'Actions', 'columnIndex': '31', 'leadingProperty': 'Actions', 'sortProperty': 'Actions', 'filterProperty': 'Actions'}"
                        />
                    </customData>
                </Column>
            </columns>
            <items>
                <ColumnListItem type="Active">
                    <cells>
                        <Text
                            text="{
        path: 'category',
        formatter: '.formatter.formatCategoryArray'
    }"
                        />
                        <Text
                            text="{
                                path: 'publishedAt',
                                formatter: '.formatDateOnly'
                            }"
                        />

                        <Text
                            text="{
                                path: 'endAnnouncement',
                                formatter: '.formatDateOnly'
                            }"
                        />

                        <Text
                            text="{
                                path: 'modifiedAt',
                                formatter: '.formatDateOnly'
                            }"
                        />

                        <ObjectStatus
                            text="{
                                path: 'announcementStatus',
                                formatter: '.formatter.formatStatusText'
                            }"
                            state="{
                                path: 'announcementStatus',
                                formatter: '.formatter.formatStatusState'
                            }"
                            icon="{
                                path: 'announcementStatus',
                                formatter: '.formatter.formatStatusIcon'
                            }"
                            inverted="true"
                        />

                        <!-- Action Buttons with conditional visibility/enabled per status -->
                        <HBox>
                            <!-- Edit: visible only for Published and Scheduled -->
                            <Button
                                id="idEditActionBtn"
                                icon="sap-icon://edit"
                                type="Transparent"
                                tooltip="{i18n>editTooltip}"
                                press="onEditPress"
                                visible="{
                                    path: 'announcementStatus',
                                    formatter: '.formatter.formatEditBtnVisibility'
                                }"
                            />
                            <!-- Edit placeholder (disabled) for other statuses to keep layout consistent -->
                            <Button
                                id="idEditActionDisabledBtn"
                                icon="sap-icon://edit"
                                type="Transparent"
                                tooltip="{i18n>editTooltip}"
                                enabled="false"
                                visible="{
                                    path: 'announcementStatus',
                                    formatter: '.formatter.formatEditBtnDisabledVisibility'
                                }"
                            />

                            <!-- Duplicate: visible for all statuses -->
                            <Button
                                id="idDuplicateActionBtn"
                                icon="sap-icon://duplicate"
                                type="Transparent"
                                tooltip="{i18n>duplicateTooltip}"
                                press="onDuplicatePress"
                            />

                            <!-- Mark As Invalid: visible only for Published -->
                            <Button
                                id="idMarkInvalidActionBtn"
                                icon="sap-icon://sys-minus"
                                type="Transparent"
                                tooltip="{i18n>markAsInvalidTooltip}"
                                press="onMarkInvalidPress"
                                visible="{
                                    path: 'announcementStatus',
                                    formatter: '.formatter.formatMarkInvalidBtnVisibility'
                                }"
                            />
                            <!-- Mark As Invalid placeholder (disabled) for non-Published statuses -->
                            <Button
                                id="idMarkInvalidActionDisabledBtn"
                                icon="sap-icon://sys-minus"
                                type="Transparent"
                                tooltip="{i18n>markAsInvalidTooltip}"
                                enabled="false"
                                visible="{
                                    path: 'announcementStatus',
                                    formatter: '.formatter.formatMarkInvalidBtnDisabledVisibility'
                                }"
                            />

                            <!-- Delete: visible only for Scheduled -->
                            <Button
                                id="idDeleteActionBtn"
                                icon="sap-icon://delete"
                                type="Transparent"
                                tooltip="{i18n>deleteTooltip}"
                                press="onDeletePress"
                                visible="{
                                    path: 'announcementStatus',
                                    formatter: '.formatter.formatDeleteBtnVisibility'
                                }"
                            />
                            <!-- Delete placeholder (disabled) for non-Scheduled statuses -->
                            <Button
                                id="idDeleteActionDisabledBtn"
                                icon="sap-icon://delete"
                                type="Transparent"
                                tooltip="{i18n>deleteTooltip}"
                                enabled="false"
                                visible="{
                                    path: 'announcementStatus',
                                    formatter: '.formatter.formatDeleteBtnDisabledVisibility'
                                }"
                            />
                        </HBox>
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
    </smartTable:SmartTable>
</mvc:View>
